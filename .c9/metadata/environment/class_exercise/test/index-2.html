{"filter":false,"title":"index-2.html","tooltip":"/class_exercise/test/index-2.html","undoManager":{"mark":13,"position":13,"stack":[[{"start":{"row":0,"column":0},"end":{"row":418,"column":7},"action":"remove","lines":["<!DOCTYPE html>","<html >","<head>","  <meta charset=\"UTF-8\">","  <title>Vue.js + d3.js - line chart</title>  ","  <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css\">","  <style>","      body {","          line-height: 1.75;","      }","","      header {","          margin-bottom: 1.5rem;","      }","","      h1 {","          margin-bottom: .5rem;","          text-align: center;","      }","","      h1 + span.byline {","          display: block;","          text-align: center;","      }","","      section {","          margin-bottom: 1.5rem;","      }","","      section.content {","          padding: 0 1.5rem;","      }","","      svg {","          background-color: #fff;","          width: 100%;","      }","","      .box {","          border: 1px solid gray;","          width: 1000px;","          margin: auto;","      }","    </style>","  <script>","  window.console = window.console || function(t) {};","  </script>","  <script src=\"//cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js\"></script> ","  <script>","  if (document.location.search.match(/type=embed/gi)) {","    window.parent.postMessage(\"resize\", \"*\");","  }","  </script>","</head>","","<body translate=\"no\" >","  <header>","  </header>","","# Vue.js + D3.js Line Chart","","  <div class=\"box\">","","<section id=\"chart\">","  <d3__chart","             :layout=\"layout\"","             :chart-data=\"chartData\"","             :axes=\"axes\"></d3__chart>","</section>","","<template id=\"d3__chart\">","  <svg :view-box.camel=\"viewBox\" preserveAspectRatio=\"xMidYMid meet\">","    <g class=\"d3__stage\" :style=\"stageStyle\">","      <d3__axis","                v-for=\"(axis, index) in _.uniq(axes)\"","                :key=\"index\"","                :axis=\"axis\"","                :layout=\"layout\"","                :scale=\"scale\"","                ></d3__axis>","      <g ref=\"d3__stage\"></g>","    </g>","  </svg>","</template>","","<template id=\"d3__axis\">","  <g :class=\"[classList]\" ref=\"axis\" :style=\"style\"></g>","</template>","</div>","","  <script src='//cdnjs.cloudflare.com/ajax/libs/vue/2.2.6/vue.js'></script>","<script src='//cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js'></script>","<script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js'></script>","","    <script >","    var response = {","  \"data\": {","    \"flipbooks\": {","      \"rawData\": [","        [\"2017-07-01T01:00:00\", 1],","        [\"2017-07-02T01:00:00\", 2],","        [\"2017-07-03T01:00:00\", 3],","        [\"2017-07-04T01:00:00\", 5],","        [\"2017-07-05T01:00:00\", 8],","        [\"2017-07-06T01:00:00\", 13],","        [\"2017-07-07T01:00:00\", 21],","        [\"2017-07-08T01:00:00\", 34],","        [\"2017-07-09T01:00:00\", 55],","        [\"2017-07-10T01:00:00\", 89],","      ]","    }","  }","};","var chartData = response.data.flipbooks.rawData;","","// Parse the data and split it into series","var columns = ['Timestamp', 'Previous', 'Current'],","  offset = 1;","var c = columns.slice(offset).map(function(id, index) {","  return {","    id: id,","    values: chartData.map(function(d) {","      return {","        timestamp: d3.utcParse(\"%Y-%m-%dT%H:%M:%S\")(d[0]).setHours(0, 0, 0, 0),","        value: d[index + offset]","      }","    })","  }","});","","// Component: SVG parent and stage","Vue.component('d3__chart', {","  template: '#d3__chart',","  props: {","    axes: {","      type: Array,","      default: function() {","        return ['left', 'bottom'];","      },","      validator: function(v) {","        return !_.difference(v, ['left', 'right', 'top', 'bottom']).length","      }","    },","    layout: Object,","    chartData: Array","  },","  computed: {","","    // SVG viewbox","    viewBox: function() {","      var outerWidth = this.layout.width + this.layout.marginLeft + this.layout.marginRight,","        outerHeight = this.layout.height + this.layout.marginTop + this.layout.marginBottom;","      return '0 0 ' + outerWidth + ' ' + outerHeight;","    },","","    // Stage","    stageStyle: function() {","      return {","        'transform': 'translate(' + this.layout.marginLeft + 'px,' + this.layout.marginTop + 'px)'","      }","    }","  },","  mounted: function() {","    this.draw();","  },","  data: function() {","    return {","      scale: {","        x: this.getScaleX(),","        y: this.getScaleY(),","        color: d3.scaleOrdinal()","          .range(['steelblue'])","          .domain(['Current', 'Previous'])","      },","    }","  },","  methods: {","","    // Get x-axis scale","    getScaleX: function() {","      return d3.scaleTime()","        .range([0, this.layout.width])","        .domain(d3.extent(chartData, function(d) {","          return d3.utcParse(\"%Y-%m-%dT%H:%M:%S\")(d[0]).setHours(0, 0, 0, 0)","        }));","    },","","    // Get y-axis scale","    getScaleY: function() {","      return d3.scaleLinear()","        .range([this.layout.height, 0])","        .domain([","          0,","           d3.max(this.chartData, function(d) {","            return 100;","          })","        ]);","    },","","    // Draw chart","    draw: function() {","","      // Define transition","      var t = d3.transition().duration(500);","","      // Define scale","      var scale = this.scale;","","      // Define stage","      var $stage = d3.select(this.$refs.d3__stage);","","      // Draw lines","      // Plotter","      var line = d3.line().x(function(d) {","          return scale.x(d.timestamp);","        })","        .y(function(d) {","          return scale.y(d.value);","        });","","      // Update","      var $line = $stage","        .selectAll('.line')","        .data(this.chartData);","","      // Exit","      $line.exit().remove();","","      // Enter","      var $line = $line.enter()","        .append('path')","        .attr('d', function(d) {","          return line(d.values.filter(function(e) {","            return typeof e.value !== typeof null;","          }));","        })","        .merge($line)","        .attr('class', 'line')","        .transition(t)","        .attr('d', function(d) {","          return line(d.values.filter(function(e) {","            return typeof e.value !== typeof null;","          }));","        })","        .style('fill', 'none')","        .style('stroke', function(d) {","          return scale.color(d.id);","        })","        .style('stroke-width', 1);","","      // Draw point series","      // Update","      var $points = $stage","        .selectAll('.series')","        .data(this.chartData);","","      // Exit","      $points.exit().remove();","","      // Enter","      var $points = $points.enter()","        .append('g')","        .attr('class', 'series')","        .merge($points)","        .style('stroke', function(d) {","          return scale.color(d.id);","        });","","      // Draw points","      // Update","      var $point = $points","        .selectAll('.point')","        .data(function(d) {","          return d.values.filter(function(e) {","            return typeof e.value !== typeof null;","          })","        });","","      // Exit","      $point.exit().remove();","    }","  },","  watch: {","    // Watch for layout changes","    layout: {","      deep: true,","      handler: function(val, oldVal) {","        this.scale.x = this.getScaleX();","        this.scale.y = this.getScaleY();","        this.draw();","      }","    },","    chartData: {","      deep: true,","      handler: function(val, oldVal) {","        this.scale.x = this.getScaleX();","        this.scale.y = this.getScaleY();","        this.draw();","      }","    }","  }","});","","// Component: Chart axes","Vue.component('d3__axis', {","  template: '#d3__axis',","  props: {","    axis: {","      type: String,","      validator: function(v) {","        return ['left', 'right', 'top', 'bottom'].indexOf(v) > -1","      }","    },","    layout: Object,","    scale: Object","  },","  //props: ['axis', 'layout', 'scale'],","  data: function() {","    return {","      // Return class list","      classList: ['axis'].concat(this.getAxisClasses())","    }","  },","  mounted: function() {","    this.drawAxis();","  },","  computed: {","    style: function() {","      return {","        transform: this.getAxisTransform()","      }","    }","  },","  methods: {","","    // Return a class list containg the appropriate labels for axes","    getAxisClasses: function() {","      var axis = {","        top: 'x',","        bottom: 'x',","        left: 'y',","        right: 'y'","      };","      return [this.axis, axis[this.axis]];","    },","","    // Draw axis","    drawAxis: function() {","","      var t = d3.transition(500);","      var $axis = d3.select(this.$refs.axis);","      var scale = this.scale;","      var axisGenerator = {","        top: d3.axisTop(scale.x).tickFormat(d3.timeFormat(\"%b %d\")),","        right: d3.axisRight(scale.y),","        bottom: d3.axisBottom(scale.x).tickFormat(d3.timeFormat(\"%b %d\")),","        left: d3.axisLeft(scale.y)","    }","","      // Transition the axis, and then call/construct it","      $axis.transition(t).call(axisGenerator[this.axis]);","    },","","    // Return necessary axis transformation for proper positioning","    getAxisTransform: function() {","","      var axisOffset = {","        top: {","          x: 0,","          y: 0","        },","        right: {","          x: this.layout.width,","          y: 0","        },","        bottom: {","          x: 0,","          y: this.layout.height","        },","        left: {","          x: 0,","          y: 0","        }","      };","","      return 'translate(' + axisOffset[this.axis].x + 'px, ' + axisOffset[this.axis].y + 'px)';","    }","  },","  watch: {","    // Changes to scale means we have to redraw the line!","    scale: {","      deep: true,","      handler: function(val, oldVal) {","        this.drawAxis();","      }","    }","  }","});","","// Initialize chart","var d3Vis = new Vue({","  el: '#chart',","  data: {","    layout: {","      width: 800,","      height: 250,","      marginTop: 45,","      marginRight: 35,","      marginBottom: 50,","      marginLeft: 50,","    },","    chartData: c,","    axes: ['left', 'bottom']","  }","});","","  </script>","</body>","</html>"],"id":2},{"start":{"row":0,"column":0},"end":{"row":68,"column":3},"action":"insert","lines":["<!DOCTYPE html>","<meta charset=\"utf-8\">","<title>SVG Swarm</title>","<style>","","svg {","  position: absolute;","  top: 0;","}","","circle {","  fill: steelblue;","  stroke: #666;","  stroke-width: 1.5px;","}","","</style>","<div id=\"fps\">FPS: <span>?</span></div>","<script src=\"//d3js.org/d3.v3.min.js\"></script>","<script>","","var data = d3.range(500).map(function() {","  return {xloc: 0, yloc: 0, xvel: 0, yvel: 0};","});","","var width = 960,","    height = 500;","","var x = d3.scale.linear()","    .domain([-5, 5])","    .range([0, width]);","","var y = d3.scale.linear()","    .domain([-5, 5])","    .range([0, height]);","","var time0 = Date.now(),","    time1;","","var fps = d3.select(\"#fps span\");","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width)","    .attr(\"height\", height);","","var circle = svg.selectAll(\"circle\")","    .data(data)","  .enter().append(\"circle\")","    .attr(\"cx\", 10)","    .attr(\"cy\", 10)","    .attr(\"r\", 1);","","d3.timer(function() {","","  data.forEach(function(d) {","    d.xloc += d.xvel;","    d.yloc += d.yvel;","    d.xvel += 0.04 * (Math.random() - .5) - 0.05 * d.xvel - 0.0005 * d.xloc;","    d.yvel += 0.04 * (Math.random() - .5) - 0.05 * d.yvel - 0.0005 * d.yloc;","  });","","  circle","      .attr(\"transform\", function(d) { return \"translate(\" + x(d.xloc) + \",\" + y(d.yloc) + \")\"; })","      .attr(\"r\", function(d) { return Math.min(1 + 1000 * Math.abs(d.xvel * d.yvel), 10); });","","  time1 = Date.now();","  fps.text(Math.round(1000 / (time1 - time0)));","  time0 = time1;","});"]}],[{"start":{"row":68,"column":3},"end":{"row":69,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":69,"column":0},"end":{"row":69,"column":9},"action":"insert","lines":["</script>"],"id":4}],[{"start":{"row":52,"column":0},"end":{"row":52,"column":3},"action":"insert","lines":["// "],"id":5},{"start":{"row":54,"column":0},"end":{"row":54,"column":3},"action":"insert","lines":["// "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":3},"action":"insert","lines":["// "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":3},"action":"insert","lines":["// "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":3},"action":"insert","lines":["// "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":3},"action":"insert","lines":["// "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":3},"action":"insert","lines":["// "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":3},"action":"insert","lines":["// "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":3},"action":"insert","lines":["// "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":3},"action":"insert","lines":["// "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":3},"action":"insert","lines":["// "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":3},"action":"insert","lines":["// "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":3},"action":"insert","lines":["// "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":3},"action":"insert","lines":["// "]}],[{"start":{"row":52,"column":0},"end":{"row":52,"column":3},"action":"remove","lines":["// "],"id":6},{"start":{"row":54,"column":0},"end":{"row":54,"column":3},"action":"remove","lines":["// "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":3},"action":"remove","lines":["// "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":3},"action":"remove","lines":["// "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":3},"action":"remove","lines":["// "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":3},"action":"remove","lines":["// "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":3},"action":"remove","lines":["// "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":3},"action":"remove","lines":["// "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":3},"action":"remove","lines":["// "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":3},"action":"remove","lines":["// "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":3},"action":"remove","lines":["// "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":3},"action":"remove","lines":["// "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":3},"action":"remove","lines":["// "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":3},"action":"remove","lines":["// "]}],[{"start":{"row":57,"column":4},"end":{"row":57,"column":7},"action":"insert","lines":["// "],"id":7},{"start":{"row":58,"column":4},"end":{"row":58,"column":7},"action":"insert","lines":["// "]}],[{"start":{"row":57,"column":4},"end":{"row":57,"column":7},"action":"remove","lines":["// "],"id":8},{"start":{"row":58,"column":4},"end":{"row":58,"column":7},"action":"remove","lines":["// "]}],[{"start":{"row":65,"column":2},"end":{"row":65,"column":5},"action":"insert","lines":["// "],"id":9},{"start":{"row":66,"column":2},"end":{"row":66,"column":5},"action":"insert","lines":["// "]},{"start":{"row":67,"column":2},"end":{"row":67,"column":5},"action":"insert","lines":["// "]}],[{"start":{"row":63,"column":6},"end":{"row":63,"column":9},"action":"insert","lines":["// "],"id":10}],[{"start":{"row":0,"column":0},"end":{"row":69,"column":9},"action":"remove","lines":["<!DOCTYPE html>","<meta charset=\"utf-8\">","<title>SVG Swarm</title>","<style>","","svg {","  position: absolute;","  top: 0;","}","","circle {","  fill: steelblue;","  stroke: #666;","  stroke-width: 1.5px;","}","","</style>","<div id=\"fps\">FPS: <span>?</span></div>","<script src=\"//d3js.org/d3.v3.min.js\"></script>","<script>","","var data = d3.range(500).map(function() {","  return {xloc: 0, yloc: 0, xvel: 0, yvel: 0};","});","","var width = 960,","    height = 500;","","var x = d3.scale.linear()","    .domain([-5, 5])","    .range([0, width]);","","var y = d3.scale.linear()","    .domain([-5, 5])","    .range([0, height]);","","var time0 = Date.now(),","    time1;","","var fps = d3.select(\"#fps span\");","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width)","    .attr(\"height\", height);","","var circle = svg.selectAll(\"circle\")","    .data(data)","  .enter().append(\"circle\")","    .attr(\"cx\", 10)","    .attr(\"cy\", 10)","    .attr(\"r\", 1);","","d3.timer(function() {","","  data.forEach(function(d) {","    d.xloc += d.xvel;","    d.yloc += d.yvel;","    d.xvel += 0.04 * (Math.random() - .5) - 0.05 * d.xvel - 0.0005 * d.xloc;","    d.yvel += 0.04 * (Math.random() - .5) - 0.05 * d.yvel - 0.0005 * d.yloc;","  });","","  circle","      .attr(\"transform\", function(d) { return \"translate(\" + x(d.xloc) + \",\" + y(d.yloc) + \")\"; })","      // .attr(\"r\", function(d) { return Math.min(1 + 1000 * Math.abs(d.xvel * d.yvel), 10); });","","  // time1 = Date.now();","  // fps.text(Math.round(1000 / (time1 - time0)));","  // time0 = time1;","});","</script>"],"id":11},{"start":{"row":0,"column":0},"end":{"row":413,"column":7},"action":"insert","lines":["<!DOCTYPE html>","<html>","\t<head>","\t\t<meta charset=\"utf-8\">","\t\t","\t\t<!-- Google fonts -->","\t\t<link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>","\t\t<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>","\t","\t\t<style>","\t\t\tbody {","\t\t\t\tfont-family: 'Open Sans', sans-serif;","\t\t\t\ttext-align: center;","\t\t\t\tfont-weight: 300;","\t\t\t}","\t\t\t","\t\t  \t.title {","\t\t    \tfont-size: 30px;","\t\t    \tcolor: #4F4F4F;","\t\t  \t}","","\t\t  \t.subtitle {","\t\t    \tfont-size: 14px;","\t\t    \tcolor: #AAAAAA;","\t\t\t\tpadding-bottom: 15px;","\t\t  \t}","","\t\t\t.geo-path {","\t\t\t\tstroke: white;","\t\t\t\tstroke-width: 0.5px;","\t\t\t\tstroke-opacity: 1;","\t\t\t\tfill: #C0AA91;","\t\t\t\tfill-opacity: 1;","\t\t\t}","","\t\t\t.cities,  .cityCover{","\t\t\t\tfill: #1A818C;","\t\t\t}","","\t\t\t.label {","\t\t\t\tfont-size: 18px;","\t\t\t\ttext-anchor: middle;","\t\t\t\tfill: #707070;","\t\t\t\tfont-family: 'Poiret One', cursive;","\t\t\t\tfont-weight: 400;","\t\t\t}","\t\t</style>","\t","\t\t","\t\t<!-- D3.js -->","\t\t<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js\" charset=\"utf-8\"></script>","","\t</head>\t","\t<body>","","\t\t<div class=\"title\">The 150 largest Cities in the World</div>","\t\t<div class=\"subtitle\">sized to population</div>\t\t","\t\t<div id=\"chart\"></div>","\t\t","\t\t<script src=\"countriesMap.js\"></script>","\t\t<script src=\"populations.js\"></script>","","\t\t<script language=\"javascript\" type=\"text/javascript\">","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////// Set up and initiate svg containers ///////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar margin  = {","\t\t\t\ttop: 100,","\t\t\t\tright: 0,","\t\t\t\tbottom: 0,","\t\t\t\tleft: 0","\t\t\t};","\t\t\tvar width = 960 - margin.left - margin.right,","\t\t\t\theight = 600 - margin.top - margin.bottom;","\t\t\t\t\t\t","\t\t\t//SVG container","\t\t\tvar svg = d3.select('#chart')","\t\t\t\t.append(\"svg\")","\t\t\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t\t\t.append(\"g\")","\t\t\t\t.attr(\"transform\", \"translate(\" + (margin.left) + \",\" + (margin.top) + \")\");","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Create filter ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\t//SVG filter for the gooey effect","\t\t\t//Code taken from http://tympanus.net/codrops/2015/03/10/creative-gooey-effects/","\t\t\tvar defs = svg.append(\"defs\");","\t\t\tvar filter = defs.append(\"filter\").attr(\"id\",\"gooeyCodeFilter\");","\t\t\tfilter.append(\"feGaussianBlur\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"stdDeviation\",\"10\")","\t\t\t\t//to fix safari: http://stackoverflow.com/questions/24295043/svg-gaussian-blur-in-safari-unexpectedly-lightens-image","\t\t\t\t.attr(\"color-interpolation-filters\",\"sRGB\") ","\t\t\t\t.attr(\"result\",\"blur\");","\t\t\tfilter.append(\"feColorMatrix\")","\t\t\t\t.attr(\"class\", \"blurValues\")","\t\t\t\t.attr(\"in\",\"blur\")","\t\t\t\t.attr(\"mode\",\"matrix\")","\t\t\t\t.attr(\"values\",\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\")","\t\t\t\t.attr(\"result\",\"gooey\");","\t\t\tfilter.append(\"feBlend\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"in2\",\"gooey\")","\t\t\t\t.attr(\"operator\",\"atop\");","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////// Set-up Map /////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Variables for the map","\t\t\tvar projection = d3.geo.mercator()","\t\t\t\t\t.scale(170)","\t\t\t\t\t.translate([480,230]);","\t  ","\t\t\tvar path = d3.geo.path()","\t\t\t\t\t.projection(projection);","\t","\t\t\tvar map = svg.append(\"g\")","\t\t\t\t\t\t.attr(\"class\", \"map\");","","\t\t\t//Initiate the world map","\t\t\tmap.selectAll(\".geo-path\")","\t\t\t\t.data(countriesMap[0].features)","\t\t\t\t.enter().append(\"path\")","\t\t\t\t\t.attr(\"class\", function(d) { return \"geo-path\" + \" \" + d.id; })","\t\t\t\t\t.attr(\"id\", function(d) { return d.properties.name; })","\t\t\t\t\t.attr(\"d\", path)","\t\t\t\t\t.style(\"stroke-opacity\", 1)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////////// Cities ///////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radius scale","\t\t\tvar rScale = d3.scale.sqrt()","\t\t\t\t.range([0,14])","\t\t\t\t.domain([0, d3.max(populations, function(d) { return d.population; })]);","","\t\t\t//Put the city locations into the data itself","\t\t\tpopulations.forEach(function(d,i) {","\t\t\t\t\td.radius = rScale(d.population);","\t\t\t\t\td.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\td.y = projection([d.longitude, d.latitude])[1];","\t\t\t});","","\t\t\t//Wrapper for the cities","\t\t\tvar cityWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"cityWrapper\")","\t\t\t\t.style(\"filter\", \"url(#gooeyCodeFilter)\");","\t\t\t\t","\t\t\t//Place the city circles","\t\t\tvar cities = cityWrapper.selectAll(\".cities\")","\t\t\t\t.data(populations)","\t\t\t\t.enter().append(\"circle\")","\t\t\t\t.attr(\"class\", \"cities\")","\t\t\t\t.attr(\"r\", function(d) { return d.radius ;})","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1])","\t\t\t\t.style(\"opacity\", 1);","","\t\t\tvar coverCirleRadius = 40;","\t\t\t//Circle over all others","\t\t\tcityWrapper.append(\"circle\")","\t\t\t\t.attr(\"class\", \"cityCover\")","\t\t\t\t.attr(\"r\", coverCirleRadius)","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1]);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Country Labels ////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Calculate the centers for each country","\t\t\tvar centers = getCenters(\"country\", [width, height/0.8]);","\t\t\tcenters.forEach(function(d) {","\t\t\t\t\td.y = d.y - 100;","\t\t\t\t\td.x = d.x + 0;","\t\t\t});//centers forEach","","\t\t\t//Wrapper for the country labels","\t\t\tvar labelWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"labelWrapper\");","\t\t\t\t","\t\t\t//Append the country labels","\t\t    labelWrapper.selectAll(\".label\")","\t\t      \t.data(centers)","\t\t      \t.enter().append(\"text\")","\t\t      \t.attr(\"class\", \"label\")","\t\t      \t.style(\"opacity\", 0)","\t\t      \t.attr(\"transform\", function (d) { return \"translate(\" + (d.x) + \", \" + (d.y - 60) + \")\"; })","\t\t      \t.text(function (d) { return d.name });","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Set-up the force //////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar force = d3.layout.force()","\t\t\t\t.gravity(.02)","\t\t    \t.charge(0)","\t\t    \t.on(\"tick\", tick(centers, \"country\"));\t","\t\t","\t\t\tvar padding = 0;","\t\t\tvar maxRadius = d3.max(populations, function(d) { return d.radius; });\t","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Do the loop /////////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\tloop();\t","\t\t\tsetInterval(loop, 15000);","\t\t\t","\t\t\tfunction loop() {","\t\t\t\tplaceCities();","\t\t\t\tsetTimeout(clusterCountry, 7000);","\t\t\t\tsetTimeout(backToCenter, 12000);","\t\t\t}//loop","\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Animation steps ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\t//Move the cities from the center to their actual locations","\t\t\tfunction placeCities () {","","\t\t\t\t//Stop the force layout (in case you move backward)","\t\t\t\tforce.stop();","","\t\t\t\t//Make the cover circle shrink","\t\t\t\td3.selectAll(\".cityCover\")","\t\t\t\t\t\t.transition().duration(5000)","\t\t\t\t\t\t.attr(\"r\", 0);","","\t\t\t\t//Put the cities in their geo location","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"move\").duration(2000)","\t\t\t\t\t.delay(function(d,i) { return i*20; })","\t\t\t\t\t.attr(\"r\", function(d) {","\t\t\t\t\t\treturn d.radius = rScale(d.population);","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cx\", function(d) {","\t\t\t\t\t\treturn d.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cy\", function(d) {","\t\t\t\t\t\treturn d.y = projection([d.longitude, d.latitude])[1];","\t\t\t\t\t});","\t\t\t\t\t\t","\t\t\t\t//Around the end of the transition above make the circles see-through a bit","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"dim\").duration(2000).delay(4000)","\t\t\t\t\t.style(\"opacity\", 0.8);","","\t\t\t\t//\"Remove\" gooey filter from cities during the transition","\t\t\t\t//So at the end they do not appear to melt together anymore","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(4000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\"); ","\t\t\t\t\t});","","\t\t\t}//placeCities","","\t\t\t//Cluster all the cities based on the country","\t\t\tfunction clusterCountry() {","","\t\t\t\t///Start force again","\t\t\t\tforce.start();","","\t\t\t\t//Dim the map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0);","\t\t\t\t\t","\t\t\t\t//Show the labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\t//Reset gooey filter values back to a visible \"gooey\" effect","\t\t\t   \td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(2000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\"); ","\t\t\t\t\t});","","\t\t\t}//clusterCountry","","\t\t\t//Move the circles back to the center location again","\t\t\tfunction backToCenter () {","","\t\t\t\t//Stop the force layout","\t\t\t\tforce.stop();","","\t\t\t\t//Hide labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 0);","","\t\t\t\t//Show map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","\t\t\t\t","\t\t\t   \t//Make the cover cirlce to its true size again","\t\t\t    d3.selectAll(\".cityCover\")","\t\t\t\t\t.transition().duration(3000).delay(500)","\t\t\t\t\t.attr(\"r\", coverCirleRadius);","","\t\t\t    //Move the cities to the 0,0 coordinate","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition()","\t\t\t\t\t.duration(2000).delay(function(d,i) { return i*10; })","\t\t\t\t\t.attr(\"cx\", projection([0, 0])[0])","\t\t\t\t\t.attr(\"cy\", projection([0, 0])[1])","\t\t\t\t\t.style(\"opacity\", 1);","\t\t\t\t\t","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(1000).delay(1000)","\t\t\t\t\t.attrTween(\"values\", function() {","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\",","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\");","\t\t\t\t\t});","","\t\t\t}//backToCenter","\t","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Helper functions //////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radial layout","\t\t\tfunction getCenters (vname, size) {","\t\t\t  \tvar centers = [], ","\t\t\t\t\tmapping,","\t\t\t\t\tflags = [];","\t\t\t\tfor( var i = 0; i < populations.length; i++) {","\t\t\t\t    if( flags[populations[i][vname]]) continue;","\t\t\t\t    flags[populations[i][vname]] = true;","\t\t\t\t    centers.push({name: populations[i][vname], value: 1});","\t\t\t\t}//for i","\t\t\t  \tcenters.sort(function(a, b){ return d3.ascending(a.name, b.name); });","","\t\t\t  \tmapping = d3.layout.pack()","\t\t\t  \t\t.sort(function(d) { return d[vname]; })","\t\t\t  \t\t.size(size);","\t\t\t  \tmapping.nodes({children: centers});","","\t\t\t  \treturn centers;","\t\t\t}//getCenters","\t","\t\t\t//Radial lay-out","\t\t\tfunction tick (centers, varname) {","\t\t\t\tvar foci = {};","\t\t\t\tfor (var i = 0; i < centers.length; i++) {","\t\t\t\t\tfoci[centers[i].name] = centers[i];","\t\t\t\t}","\t  ","\t\t\t\treturn function (e) {","\t\t\t\t\tfor (var i = 0; i < populations.length; i++) {","\t\t\t\t\t  var o = populations[i];","\t\t\t\t\t  var f = foci[o[varname]];","\t\t\t\t\t  o.y += (f.y - o.y) * e.alpha;","\t\t\t\t\t  o.x += (f.x - o.x) * e.alpha;","\t\t\t\t\t}//for","","\t\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t\t.each(collide(.5))","\t\t\t\t\t\t.attr(\"cx\", function (d) { return d.x; })","\t\t\t\t\t\t.attr(\"cy\", function (d) { return d.y; });","","\t\t\t\t}//function","\t\t\t}//tick","","\t\t\tfunction collide(alpha) {","\t\t          var quadtree = d3.geom.quadtree(populations);","\t\t          return function (d) {","\t\t            var r = d.radius + maxRadius + padding,","\t\t                nx1 = d.x - r,","\t\t                nx2 = d.x + r,","\t\t                ny1 = d.y - r,","\t\t                ny2 = d.y + r;","\t\t            quadtree.visit(function(quad, x1, y1, x2, y2) {","\t\t              if (quad.point && (quad.point !== d)) {","\t\t                var x = d.x - quad.point.x,","\t\t                    y = d.y - quad.point.y,","\t\t                    l = Math.sqrt(x * x + y * y),","\t\t                    r = d.radius + quad.point.radius + padding;","\t\t                if (l < r) {","\t\t                  l = (l - r) / l * alpha;","\t\t                  d.x -= x *= l;","\t\t                  d.y -= y *= l;","\t\t                  quad.point.x += x;","\t\t                  quad.point.y += y;","\t\t                }","\t\t              }","\t\t              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;","\t\t            });","\t\t          };","\t\t    }//collide","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t</script>","","\t</body>","</html>"]}],[{"start":{"row":0,"column":0},"end":{"row":413,"column":7},"action":"remove","lines":["<!DOCTYPE html>","<html>","\t<head>","\t\t<meta charset=\"utf-8\">","\t\t","\t\t<!-- Google fonts -->","\t\t<link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>","\t\t<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>","\t","\t\t<style>","\t\t\tbody {","\t\t\t\tfont-family: 'Open Sans', sans-serif;","\t\t\t\ttext-align: center;","\t\t\t\tfont-weight: 300;","\t\t\t}","\t\t\t","\t\t  \t.title {","\t\t    \tfont-size: 30px;","\t\t    \tcolor: #4F4F4F;","\t\t  \t}","","\t\t  \t.subtitle {","\t\t    \tfont-size: 14px;","\t\t    \tcolor: #AAAAAA;","\t\t\t\tpadding-bottom: 15px;","\t\t  \t}","","\t\t\t.geo-path {","\t\t\t\tstroke: white;","\t\t\t\tstroke-width: 0.5px;","\t\t\t\tstroke-opacity: 1;","\t\t\t\tfill: #C0AA91;","\t\t\t\tfill-opacity: 1;","\t\t\t}","","\t\t\t.cities,  .cityCover{","\t\t\t\tfill: #1A818C;","\t\t\t}","","\t\t\t.label {","\t\t\t\tfont-size: 18px;","\t\t\t\ttext-anchor: middle;","\t\t\t\tfill: #707070;","\t\t\t\tfont-family: 'Poiret One', cursive;","\t\t\t\tfont-weight: 400;","\t\t\t}","\t\t</style>","\t","\t\t","\t\t<!-- D3.js -->","\t\t<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js\" charset=\"utf-8\"></script>","","\t</head>\t","\t<body>","","\t\t<div class=\"title\">The 150 largest Cities in the World</div>","\t\t<div class=\"subtitle\">sized to population</div>\t\t","\t\t<div id=\"chart\"></div>","\t\t","\t\t<script src=\"countriesMap.js\"></script>","\t\t<script src=\"populations.js\"></script>","","\t\t<script language=\"javascript\" type=\"text/javascript\">","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////// Set up and initiate svg containers ///////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar margin  = {","\t\t\t\ttop: 100,","\t\t\t\tright: 0,","\t\t\t\tbottom: 0,","\t\t\t\tleft: 0","\t\t\t};","\t\t\tvar width = 960 - margin.left - margin.right,","\t\t\t\theight = 600 - margin.top - margin.bottom;","\t\t\t\t\t\t","\t\t\t//SVG container","\t\t\tvar svg = d3.select('#chart')","\t\t\t\t.append(\"svg\")","\t\t\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t\t\t.append(\"g\")","\t\t\t\t.attr(\"transform\", \"translate(\" + (margin.left) + \",\" + (margin.top) + \")\");","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Create filter ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\t//SVG filter for the gooey effect","\t\t\t//Code taken from http://tympanus.net/codrops/2015/03/10/creative-gooey-effects/","\t\t\tvar defs = svg.append(\"defs\");","\t\t\tvar filter = defs.append(\"filter\").attr(\"id\",\"gooeyCodeFilter\");","\t\t\tfilter.append(\"feGaussianBlur\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"stdDeviation\",\"10\")","\t\t\t\t//to fix safari: http://stackoverflow.com/questions/24295043/svg-gaussian-blur-in-safari-unexpectedly-lightens-image","\t\t\t\t.attr(\"color-interpolation-filters\",\"sRGB\") ","\t\t\t\t.attr(\"result\",\"blur\");","\t\t\tfilter.append(\"feColorMatrix\")","\t\t\t\t.attr(\"class\", \"blurValues\")","\t\t\t\t.attr(\"in\",\"blur\")","\t\t\t\t.attr(\"mode\",\"matrix\")","\t\t\t\t.attr(\"values\",\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\")","\t\t\t\t.attr(\"result\",\"gooey\");","\t\t\tfilter.append(\"feBlend\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"in2\",\"gooey\")","\t\t\t\t.attr(\"operator\",\"atop\");","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////// Set-up Map /////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Variables for the map","\t\t\tvar projection = d3.geo.mercator()","\t\t\t\t\t.scale(170)","\t\t\t\t\t.translate([480,230]);","\t  ","\t\t\tvar path = d3.geo.path()","\t\t\t\t\t.projection(projection);","\t","\t\t\tvar map = svg.append(\"g\")","\t\t\t\t\t\t.attr(\"class\", \"map\");","","\t\t\t//Initiate the world map","\t\t\tmap.selectAll(\".geo-path\")","\t\t\t\t.data(countriesMap[0].features)","\t\t\t\t.enter().append(\"path\")","\t\t\t\t\t.attr(\"class\", function(d) { return \"geo-path\" + \" \" + d.id; })","\t\t\t\t\t.attr(\"id\", function(d) { return d.properties.name; })","\t\t\t\t\t.attr(\"d\", path)","\t\t\t\t\t.style(\"stroke-opacity\", 1)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////////// Cities ///////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radius scale","\t\t\tvar rScale = d3.scale.sqrt()","\t\t\t\t.range([0,14])","\t\t\t\t.domain([0, d3.max(populations, function(d) { return d.population; })]);","","\t\t\t//Put the city locations into the data itself","\t\t\tpopulations.forEach(function(d,i) {","\t\t\t\t\td.radius = rScale(d.population);","\t\t\t\t\td.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\td.y = projection([d.longitude, d.latitude])[1];","\t\t\t});","","\t\t\t//Wrapper for the cities","\t\t\tvar cityWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"cityWrapper\")","\t\t\t\t.style(\"filter\", \"url(#gooeyCodeFilter)\");","\t\t\t\t","\t\t\t//Place the city circles","\t\t\tvar cities = cityWrapper.selectAll(\".cities\")","\t\t\t\t.data(populations)","\t\t\t\t.enter().append(\"circle\")","\t\t\t\t.attr(\"class\", \"cities\")","\t\t\t\t.attr(\"r\", function(d) { return d.radius ;})","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1])","\t\t\t\t.style(\"opacity\", 1);","","\t\t\tvar coverCirleRadius = 40;","\t\t\t//Circle over all others","\t\t\tcityWrapper.append(\"circle\")","\t\t\t\t.attr(\"class\", \"cityCover\")","\t\t\t\t.attr(\"r\", coverCirleRadius)","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1]);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Country Labels ////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Calculate the centers for each country","\t\t\tvar centers = getCenters(\"country\", [width, height/0.8]);","\t\t\tcenters.forEach(function(d) {","\t\t\t\t\td.y = d.y - 100;","\t\t\t\t\td.x = d.x + 0;","\t\t\t});//centers forEach","","\t\t\t//Wrapper for the country labels","\t\t\tvar labelWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"labelWrapper\");","\t\t\t\t","\t\t\t//Append the country labels","\t\t    labelWrapper.selectAll(\".label\")","\t\t      \t.data(centers)","\t\t      \t.enter().append(\"text\")","\t\t      \t.attr(\"class\", \"label\")","\t\t      \t.style(\"opacity\", 0)","\t\t      \t.attr(\"transform\", function (d) { return \"translate(\" + (d.x) + \", \" + (d.y - 60) + \")\"; })","\t\t      \t.text(function (d) { return d.name });","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Set-up the force //////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar force = d3.layout.force()","\t\t\t\t.gravity(.02)","\t\t    \t.charge(0)","\t\t    \t.on(\"tick\", tick(centers, \"country\"));\t","\t\t","\t\t\tvar padding = 0;","\t\t\tvar maxRadius = d3.max(populations, function(d) { return d.radius; });\t","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Do the loop /////////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\tloop();\t","\t\t\tsetInterval(loop, 15000);","\t\t\t","\t\t\tfunction loop() {","\t\t\t\tplaceCities();","\t\t\t\tsetTimeout(clusterCountry, 7000);","\t\t\t\tsetTimeout(backToCenter, 12000);","\t\t\t}//loop","\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Animation steps ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\t//Move the cities from the center to their actual locations","\t\t\tfunction placeCities () {","","\t\t\t\t//Stop the force layout (in case you move backward)","\t\t\t\tforce.stop();","","\t\t\t\t//Make the cover circle shrink","\t\t\t\td3.selectAll(\".cityCover\")","\t\t\t\t\t\t.transition().duration(5000)","\t\t\t\t\t\t.attr(\"r\", 0);","","\t\t\t\t//Put the cities in their geo location","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"move\").duration(2000)","\t\t\t\t\t.delay(function(d,i) { return i*20; })","\t\t\t\t\t.attr(\"r\", function(d) {","\t\t\t\t\t\treturn d.radius = rScale(d.population);","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cx\", function(d) {","\t\t\t\t\t\treturn d.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cy\", function(d) {","\t\t\t\t\t\treturn d.y = projection([d.longitude, d.latitude])[1];","\t\t\t\t\t});","\t\t\t\t\t\t","\t\t\t\t//Around the end of the transition above make the circles see-through a bit","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"dim\").duration(2000).delay(4000)","\t\t\t\t\t.style(\"opacity\", 0.8);","","\t\t\t\t//\"Remove\" gooey filter from cities during the transition","\t\t\t\t//So at the end they do not appear to melt together anymore","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(4000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\"); ","\t\t\t\t\t});","","\t\t\t}//placeCities","","\t\t\t//Cluster all the cities based on the country","\t\t\tfunction clusterCountry() {","","\t\t\t\t///Start force again","\t\t\t\tforce.start();","","\t\t\t\t//Dim the map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0);","\t\t\t\t\t","\t\t\t\t//Show the labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\t//Reset gooey filter values back to a visible \"gooey\" effect","\t\t\t   \td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(2000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\"); ","\t\t\t\t\t});","","\t\t\t}//clusterCountry","","\t\t\t//Move the circles back to the center location again","\t\t\tfunction backToCenter () {","","\t\t\t\t//Stop the force layout","\t\t\t\tforce.stop();","","\t\t\t\t//Hide labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 0);","","\t\t\t\t//Show map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","\t\t\t\t","\t\t\t   \t//Make the cover cirlce to its true size again","\t\t\t    d3.selectAll(\".cityCover\")","\t\t\t\t\t.transition().duration(3000).delay(500)","\t\t\t\t\t.attr(\"r\", coverCirleRadius);","","\t\t\t    //Move the cities to the 0,0 coordinate","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition()","\t\t\t\t\t.duration(2000).delay(function(d,i) { return i*10; })","\t\t\t\t\t.attr(\"cx\", projection([0, 0])[0])","\t\t\t\t\t.attr(\"cy\", projection([0, 0])[1])","\t\t\t\t\t.style(\"opacity\", 1);","\t\t\t\t\t","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(1000).delay(1000)","\t\t\t\t\t.attrTween(\"values\", function() {","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\",","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\");","\t\t\t\t\t});","","\t\t\t}//backToCenter","\t","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Helper functions //////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radial layout","\t\t\tfunction getCenters (vname, size) {","\t\t\t  \tvar centers = [], ","\t\t\t\t\tmapping,","\t\t\t\t\tflags = [];","\t\t\t\tfor( var i = 0; i < populations.length; i++) {","\t\t\t\t    if( flags[populations[i][vname]]) continue;","\t\t\t\t    flags[populations[i][vname]] = true;","\t\t\t\t    centers.push({name: populations[i][vname], value: 1});","\t\t\t\t}//for i","\t\t\t  \tcenters.sort(function(a, b){ return d3.ascending(a.name, b.name); });","","\t\t\t  \tmapping = d3.layout.pack()","\t\t\t  \t\t.sort(function(d) { return d[vname]; })","\t\t\t  \t\t.size(size);","\t\t\t  \tmapping.nodes({children: centers});","","\t\t\t  \treturn centers;","\t\t\t}//getCenters","\t","\t\t\t//Radial lay-out","\t\t\tfunction tick (centers, varname) {","\t\t\t\tvar foci = {};","\t\t\t\tfor (var i = 0; i < centers.length; i++) {","\t\t\t\t\tfoci[centers[i].name] = centers[i];","\t\t\t\t}","\t  ","\t\t\t\treturn function (e) {","\t\t\t\t\tfor (var i = 0; i < populations.length; i++) {","\t\t\t\t\t  var o = populations[i];","\t\t\t\t\t  var f = foci[o[varname]];","\t\t\t\t\t  o.y += (f.y - o.y) * e.alpha;","\t\t\t\t\t  o.x += (f.x - o.x) * e.alpha;","\t\t\t\t\t}//for","","\t\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t\t.each(collide(.5))","\t\t\t\t\t\t.attr(\"cx\", function (d) { return d.x; })","\t\t\t\t\t\t.attr(\"cy\", function (d) { return d.y; });","","\t\t\t\t}//function","\t\t\t}//tick","","\t\t\tfunction collide(alpha) {","\t\t          var quadtree = d3.geom.quadtree(populations);","\t\t          return function (d) {","\t\t            var r = d.radius + maxRadius + padding,","\t\t                nx1 = d.x - r,","\t\t                nx2 = d.x + r,","\t\t                ny1 = d.y - r,","\t\t                ny2 = d.y + r;","\t\t            quadtree.visit(function(quad, x1, y1, x2, y2) {","\t\t              if (quad.point && (quad.point !== d)) {","\t\t                var x = d.x - quad.point.x,","\t\t                    y = d.y - quad.point.y,","\t\t                    l = Math.sqrt(x * x + y * y),","\t\t                    r = d.radius + quad.point.radius + padding;","\t\t                if (l < r) {","\t\t                  l = (l - r) / l * alpha;","\t\t                  d.x -= x *= l;","\t\t                  d.y -= y *= l;","\t\t                  quad.point.x += x;","\t\t                  quad.point.y += y;","\t\t                }","\t\t              }","\t\t              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;","\t\t            });","\t\t          };","\t\t    }//collide","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t</script>","","\t</body>","</html>"],"id":12},{"start":{"row":0,"column":0},"end":{"row":413,"column":7},"action":"insert","lines":["<!DOCTYPE html>","<html>","\t<head>","\t\t<meta charset=\"utf-8\">","\t\t","\t\t<!-- Google fonts -->","\t\t<link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>","\t\t<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>","\t","\t\t<style>","\t\t\tbody {","\t\t\t\tfont-family: 'Open Sans', sans-serif;","\t\t\t\ttext-align: center;","\t\t\t\tfont-weight: 300;","\t\t\t}","\t\t\t","\t\t  \t.title {","\t\t    \tfont-size: 30px;","\t\t    \tcolor: #4F4F4F;","\t\t  \t}","","\t\t  \t.subtitle {","\t\t    \tfont-size: 14px;","\t\t    \tcolor: #AAAAAA;","\t\t\t\tpadding-bottom: 15px;","\t\t  \t}","","\t\t\t.geo-path {","\t\t\t\tstroke: white;","\t\t\t\tstroke-width: 0.5px;","\t\t\t\tstroke-opacity: 1;","\t\t\t\tfill: #C0AA91;","\t\t\t\tfill-opacity: 1;","\t\t\t}","","\t\t\t.cities,  .cityCover{","\t\t\t\tfill: #1A818C;","\t\t\t}","","\t\t\t.label {","\t\t\t\tfont-size: 18px;","\t\t\t\ttext-anchor: middle;","\t\t\t\tfill: #707070;","\t\t\t\tfont-family: 'Poiret One', cursive;","\t\t\t\tfont-weight: 400;","\t\t\t}","\t\t</style>","\t","\t\t","\t\t<!-- D3.js -->","\t\t<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js\" charset=\"utf-8\"></script>","","\t</head>\t","\t<body>","","\t\t<div class=\"title\">The 150 largest Cities in the World</div>","\t\t<div class=\"subtitle\">sized to population</div>\t\t","\t\t<div id=\"chart\"></div>","\t\t","\t\t<script src=\"countriesMap.js\"></script>","\t\t<script src=\"populations.js\"></script>","","\t\t<script language=\"javascript\" type=\"text/javascript\">","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////// Set up and initiate svg containers ///////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar margin  = {","\t\t\t\ttop: 100,","\t\t\t\tright: 0,","\t\t\t\tbottom: 0,","\t\t\t\tleft: 0","\t\t\t};","\t\t\tvar width = 960 - margin.left - margin.right,","\t\t\t\theight = 600 - margin.top - margin.bottom;","\t\t\t\t\t\t","\t\t\t//SVG container","\t\t\tvar svg = d3.select('#chart')","\t\t\t\t.append(\"svg\")","\t\t\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t\t\t.append(\"g\")","\t\t\t\t.attr(\"transform\", \"translate(\" + (margin.left) + \",\" + (margin.top) + \")\");","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Create filter ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\t//SVG filter for the gooey effect","\t\t\t//Code taken from http://tympanus.net/codrops/2015/03/10/creative-gooey-effects/","\t\t\tvar defs = svg.append(\"defs\");","\t\t\tvar filter = defs.append(\"filter\").attr(\"id\",\"gooeyCodeFilter\");","\t\t\tfilter.append(\"feGaussianBlur\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"stdDeviation\",\"10\")","\t\t\t\t//to fix safari: http://stackoverflow.com/questions/24295043/svg-gaussian-blur-in-safari-unexpectedly-lightens-image","\t\t\t\t.attr(\"color-interpolation-filters\",\"sRGB\") ","\t\t\t\t.attr(\"result\",\"blur\");","\t\t\tfilter.append(\"feColorMatrix\")","\t\t\t\t.attr(\"class\", \"blurValues\")","\t\t\t\t.attr(\"in\",\"blur\")","\t\t\t\t.attr(\"mode\",\"matrix\")","\t\t\t\t.attr(\"values\",\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\")","\t\t\t\t.attr(\"result\",\"gooey\");","\t\t\tfilter.append(\"feBlend\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"in2\",\"gooey\")","\t\t\t\t.attr(\"operator\",\"atop\");","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////// Set-up Map /////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Variables for the map","\t\t\tvar projection = d3.geo.mercator()","\t\t\t\t\t.scale(170)","\t\t\t\t\t.translate([480,230]);","\t  ","\t\t\tvar path = d3.geo.path()","\t\t\t\t\t.projection(projection);","\t","\t\t\tvar map = svg.append(\"g\")","\t\t\t\t\t\t.attr(\"class\", \"map\");","","\t\t\t//Initiate the world map","\t\t\tmap.selectAll(\".geo-path\")","\t\t\t\t.data(countriesMap[0].features)","\t\t\t\t.enter().append(\"path\")","\t\t\t\t\t.attr(\"class\", function(d) { return \"geo-path\" + \" \" + d.id; })","\t\t\t\t\t.attr(\"id\", function(d) { return d.properties.name; })","\t\t\t\t\t.attr(\"d\", path)","\t\t\t\t\t.style(\"stroke-opacity\", 1)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////////// Cities ///////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radius scale","\t\t\tvar rScale = d3.scale.sqrt()","\t\t\t\t.range([0,14])","\t\t\t\t.domain([0, d3.max(populations, function(d) { return d.population; })]);","","\t\t\t//Put the city locations into the data itself","\t\t\tpopulations.forEach(function(d,i) {","\t\t\t\t\td.radius = rScale(d.population);","\t\t\t\t\td.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\td.y = projection([d.longitude, d.latitude])[1];","\t\t\t});","","\t\t\t//Wrapper for the cities","\t\t\tvar cityWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"cityWrapper\")","\t\t\t\t.style(\"filter\", \"url(#gooeyCodeFilter)\");","\t\t\t\t","\t\t\t//Place the city circles","\t\t\tvar cities = cityWrapper.selectAll(\".cities\")","\t\t\t\t.data(populations)","\t\t\t\t.enter().append(\"circle\")","\t\t\t\t.attr(\"class\", \"cities\")","\t\t\t\t.attr(\"r\", function(d) { return d.radius ;})","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1])","\t\t\t\t.style(\"opacity\", 1);","","\t\t\tvar coverCirleRadius = 40;","\t\t\t//Circle over all others","\t\t\tcityWrapper.append(\"circle\")","\t\t\t\t.attr(\"class\", \"cityCover\")","\t\t\t\t.attr(\"r\", coverCirleRadius)","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1]);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Country Labels ////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Calculate the centers for each country","\t\t\tvar centers = getCenters(\"country\", [width, height/0.8]);","\t\t\tcenters.forEach(function(d) {","\t\t\t\t\td.y = d.y - 100;","\t\t\t\t\td.x = d.x + 0;","\t\t\t});//centers forEach","","\t\t\t//Wrapper for the country labels","\t\t\tvar labelWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"labelWrapper\");","\t\t\t\t","\t\t\t//Append the country labels","\t\t    labelWrapper.selectAll(\".label\")","\t\t      \t.data(centers)","\t\t      \t.enter().append(\"text\")","\t\t      \t.attr(\"class\", \"label\")","\t\t      \t.style(\"opacity\", 0)","\t\t      \t.attr(\"transform\", function (d) { return \"translate(\" + (d.x) + \", \" + (d.y - 60) + \")\"; })","\t\t      \t.text(function (d) { return d.name });","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Set-up the force //////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar force = d3.layout.force()","\t\t\t\t.gravity(.02)","\t\t    \t.charge(0)","\t\t    \t.on(\"tick\", tick(centers, \"country\"));\t","\t\t","\t\t\tvar padding = 0;","\t\t\tvar maxRadius = d3.max(populations, function(d) { return d.radius; });\t","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Do the loop /////////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\tloop();\t","\t\t\tsetInterval(loop, 15000);","\t\t\t","\t\t\tfunction loop() {","\t\t\t\tplaceCities();","\t\t\t\tsetTimeout(clusterCountry, 7000);","\t\t\t\tsetTimeout(backToCenter, 12000);","\t\t\t}//loop","\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Animation steps ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\t//Move the cities from the center to their actual locations","\t\t\tfunction placeCities () {","","\t\t\t\t//Stop the force layout (in case you move backward)","\t\t\t\tforce.stop();","","\t\t\t\t//Make the cover circle shrink","\t\t\t\td3.selectAll(\".cityCover\")","\t\t\t\t\t\t.transition().duration(5000)","\t\t\t\t\t\t.attr(\"r\", 0);","","\t\t\t\t//Put the cities in their geo location","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"move\").duration(2000)","\t\t\t\t\t.delay(function(d,i) { return i*20; })","\t\t\t\t\t.attr(\"r\", function(d) {","\t\t\t\t\t\treturn d.radius = rScale(d.population);","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cx\", function(d) {","\t\t\t\t\t\treturn d.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cy\", function(d) {","\t\t\t\t\t\treturn d.y = projection([d.longitude, d.latitude])[1];","\t\t\t\t\t});","\t\t\t\t\t\t","\t\t\t\t//Around the end of the transition above make the circles see-through a bit","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"dim\").duration(2000).delay(4000)","\t\t\t\t\t.style(\"opacity\", 0.8);","","\t\t\t\t//\"Remove\" gooey filter from cities during the transition","\t\t\t\t//So at the end they do not appear to melt together anymore","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(4000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\"); ","\t\t\t\t\t});","","\t\t\t}//placeCities","","\t\t\t//Cluster all the cities based on the country","\t\t\tfunction clusterCountry() {","","\t\t\t\t///Start force again","\t\t\t\tforce.start();","","\t\t\t\t//Dim the map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0);","\t\t\t\t\t","\t\t\t\t//Show the labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\t//Reset gooey filter values back to a visible \"gooey\" effect","\t\t\t   \td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(2000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\"); ","\t\t\t\t\t});","","\t\t\t}//clusterCountry","","\t\t\t//Move the circles back to the center location again","\t\t\tfunction backToCenter () {","","\t\t\t\t//Stop the force layout","\t\t\t\tforce.stop();","","\t\t\t\t//Hide labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 0);","","\t\t\t\t//Show map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","\t\t\t\t","\t\t\t   \t//Make the cover cirlce to its true size again","\t\t\t    d3.selectAll(\".cityCover\")","\t\t\t\t\t.transition().duration(3000).delay(500)","\t\t\t\t\t.attr(\"r\", coverCirleRadius);","","\t\t\t    //Move the cities to the 0,0 coordinate","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition()","\t\t\t\t\t.duration(2000).delay(function(d,i) { return i*10; })","\t\t\t\t\t.attr(\"cx\", projection([0, 0])[0])","\t\t\t\t\t.attr(\"cy\", projection([0, 0])[1])","\t\t\t\t\t.style(\"opacity\", 1);","\t\t\t\t\t","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(1000).delay(1000)","\t\t\t\t\t.attrTween(\"values\", function() {","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\",","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\");","\t\t\t\t\t});","","\t\t\t}//backToCenter","\t","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Helper functions //////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radial layout","\t\t\tfunction getCenters (vname, size) {","\t\t\t  \tvar centers = [], ","\t\t\t\t\tmapping,","\t\t\t\t\tflags = [];","\t\t\t\tfor( var i = 0; i < populations.length; i++) {","\t\t\t\t    if( flags[populations[i][vname]]) continue;","\t\t\t\t    flags[populations[i][vname]] = true;","\t\t\t\t    centers.push({name: populations[i][vname], value: 1});","\t\t\t\t}//for i","\t\t\t  \tcenters.sort(function(a, b){ return d3.ascending(a.name, b.name); });","","\t\t\t  \tmapping = d3.layout.pack()","\t\t\t  \t\t.sort(function(d) { return d[vname]; })","\t\t\t  \t\t.size(size);","\t\t\t  \tmapping.nodes({children: centers});","","\t\t\t  \treturn centers;","\t\t\t}//getCenters","\t","\t\t\t//Radial lay-out","\t\t\tfunction tick (centers, varname) {","\t\t\t\tvar foci = {};","\t\t\t\tfor (var i = 0; i < centers.length; i++) {","\t\t\t\t\tfoci[centers[i].name] = centers[i];","\t\t\t\t}","\t  ","\t\t\t\treturn function (e) {","\t\t\t\t\tfor (var i = 0; i < populations.length; i++) {","\t\t\t\t\t  var o = populations[i];","\t\t\t\t\t  var f = foci[o[varname]];","\t\t\t\t\t  o.y += (f.y - o.y) * e.alpha;","\t\t\t\t\t  o.x += (f.x - o.x) * e.alpha;","\t\t\t\t\t}//for","","\t\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t\t.each(collide(.5))","\t\t\t\t\t\t.attr(\"cx\", function (d) { return d.x; })","\t\t\t\t\t\t.attr(\"cy\", function (d) { return d.y; });","","\t\t\t\t}//function","\t\t\t}//tick","","\t\t\tfunction collide(alpha) {","\t\t          var quadtree = d3.geom.quadtree(populations);","\t\t          return function (d) {","\t\t            var r = d.radius + maxRadius + padding,","\t\t                nx1 = d.x - r,","\t\t                nx2 = d.x + r,","\t\t                ny1 = d.y - r,","\t\t                ny2 = d.y + r;","\t\t            quadtree.visit(function(quad, x1, y1, x2, y2) {","\t\t              if (quad.point && (quad.point !== d)) {","\t\t                var x = d.x - quad.point.x,","\t\t                    y = d.y - quad.point.y,","\t\t                    l = Math.sqrt(x * x + y * y),","\t\t                    r = d.radius + quad.point.radius + padding;","\t\t                if (l < r) {","\t\t                  l = (l - r) / l * alpha;","\t\t                  d.x -= x *= l;","\t\t                  d.y -= y *= l;","\t\t                  quad.point.x += x;","\t\t                  quad.point.y += y;","\t\t                }","\t\t              }","\t\t              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;","\t\t            });","\t\t          };","\t\t    }//collide","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t</script>","","\t</body>","</html>"]}],[{"start":{"row":0,"column":0},"end":{"row":413,"column":7},"action":"remove","lines":["<!DOCTYPE html>","<html>","\t<head>","\t\t<meta charset=\"utf-8\">","\t\t","\t\t<!-- Google fonts -->","\t\t<link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>","\t\t<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>","\t","\t\t<style>","\t\t\tbody {","\t\t\t\tfont-family: 'Open Sans', sans-serif;","\t\t\t\ttext-align: center;","\t\t\t\tfont-weight: 300;","\t\t\t}","\t\t\t","\t\t  \t.title {","\t\t    \tfont-size: 30px;","\t\t    \tcolor: #4F4F4F;","\t\t  \t}","","\t\t  \t.subtitle {","\t\t    \tfont-size: 14px;","\t\t    \tcolor: #AAAAAA;","\t\t\t\tpadding-bottom: 15px;","\t\t  \t}","","\t\t\t.geo-path {","\t\t\t\tstroke: white;","\t\t\t\tstroke-width: 0.5px;","\t\t\t\tstroke-opacity: 1;","\t\t\t\tfill: #C0AA91;","\t\t\t\tfill-opacity: 1;","\t\t\t}","","\t\t\t.cities,  .cityCover{","\t\t\t\tfill: #1A818C;","\t\t\t}","","\t\t\t.label {","\t\t\t\tfont-size: 18px;","\t\t\t\ttext-anchor: middle;","\t\t\t\tfill: #707070;","\t\t\t\tfont-family: 'Poiret One', cursive;","\t\t\t\tfont-weight: 400;","\t\t\t}","\t\t</style>","\t","\t\t","\t\t<!-- D3.js -->","\t\t<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js\" charset=\"utf-8\"></script>","","\t</head>\t","\t<body>","","\t\t<div class=\"title\">The 150 largest Cities in the World</div>","\t\t<div class=\"subtitle\">sized to population</div>\t\t","\t\t<div id=\"chart\"></div>","\t\t","\t\t<script src=\"countriesMap.js\"></script>","\t\t<script src=\"populations.js\"></script>","","\t\t<script language=\"javascript\" type=\"text/javascript\">","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////// Set up and initiate svg containers ///////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar margin  = {","\t\t\t\ttop: 100,","\t\t\t\tright: 0,","\t\t\t\tbottom: 0,","\t\t\t\tleft: 0","\t\t\t};","\t\t\tvar width = 960 - margin.left - margin.right,","\t\t\t\theight = 600 - margin.top - margin.bottom;","\t\t\t\t\t\t","\t\t\t//SVG container","\t\t\tvar svg = d3.select('#chart')","\t\t\t\t.append(\"svg\")","\t\t\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t\t\t.append(\"g\")","\t\t\t\t.attr(\"transform\", \"translate(\" + (margin.left) + \",\" + (margin.top) + \")\");","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Create filter ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\t//SVG filter for the gooey effect","\t\t\t//Code taken from http://tympanus.net/codrops/2015/03/10/creative-gooey-effects/","\t\t\tvar defs = svg.append(\"defs\");","\t\t\tvar filter = defs.append(\"filter\").attr(\"id\",\"gooeyCodeFilter\");","\t\t\tfilter.append(\"feGaussianBlur\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"stdDeviation\",\"10\")","\t\t\t\t//to fix safari: http://stackoverflow.com/questions/24295043/svg-gaussian-blur-in-safari-unexpectedly-lightens-image","\t\t\t\t.attr(\"color-interpolation-filters\",\"sRGB\") ","\t\t\t\t.attr(\"result\",\"blur\");","\t\t\tfilter.append(\"feColorMatrix\")","\t\t\t\t.attr(\"class\", \"blurValues\")","\t\t\t\t.attr(\"in\",\"blur\")","\t\t\t\t.attr(\"mode\",\"matrix\")","\t\t\t\t.attr(\"values\",\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\")","\t\t\t\t.attr(\"result\",\"gooey\");","\t\t\tfilter.append(\"feBlend\")","\t\t\t\t.attr(\"in\",\"SourceGraphic\")","\t\t\t\t.attr(\"in2\",\"gooey\")","\t\t\t\t.attr(\"operator\",\"atop\");","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////// Set-up Map /////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Variables for the map","\t\t\tvar projection = d3.geo.mercator()","\t\t\t\t\t.scale(170)","\t\t\t\t\t.translate([480,230]);","\t  ","\t\t\tvar path = d3.geo.path()","\t\t\t\t\t.projection(projection);","\t","\t\t\tvar map = svg.append(\"g\")","\t\t\t\t\t\t.attr(\"class\", \"map\");","","\t\t\t//Initiate the world map","\t\t\tmap.selectAll(\".geo-path\")","\t\t\t\t.data(countriesMap[0].features)","\t\t\t\t.enter().append(\"path\")","\t\t\t\t\t.attr(\"class\", function(d) { return \"geo-path\" + \" \" + d.id; })","\t\t\t\t\t.attr(\"id\", function(d) { return d.properties.name; })","\t\t\t\t\t.attr(\"d\", path)","\t\t\t\t\t.style(\"stroke-opacity\", 1)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t//////////////////////////////// Cities ///////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radius scale","\t\t\tvar rScale = d3.scale.sqrt()","\t\t\t\t.range([0,14])","\t\t\t\t.domain([0, d3.max(populations, function(d) { return d.population; })]);","","\t\t\t//Put the city locations into the data itself","\t\t\tpopulations.forEach(function(d,i) {","\t\t\t\t\td.radius = rScale(d.population);","\t\t\t\t\td.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\td.y = projection([d.longitude, d.latitude])[1];","\t\t\t});","","\t\t\t//Wrapper for the cities","\t\t\tvar cityWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"cityWrapper\")","\t\t\t\t.style(\"filter\", \"url(#gooeyCodeFilter)\");","\t\t\t\t","\t\t\t//Place the city circles","\t\t\tvar cities = cityWrapper.selectAll(\".cities\")","\t\t\t\t.data(populations)","\t\t\t\t.enter().append(\"circle\")","\t\t\t\t.attr(\"class\", \"cities\")","\t\t\t\t.attr(\"r\", function(d) { return d.radius ;})","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1])","\t\t\t\t.style(\"opacity\", 1);","","\t\t\tvar coverCirleRadius = 40;","\t\t\t//Circle over all others","\t\t\tcityWrapper.append(\"circle\")","\t\t\t\t.attr(\"class\", \"cityCover\")","\t\t\t\t.attr(\"r\", coverCirleRadius)","\t\t\t\t.attr(\"cx\", projection([0,0])[0])","\t\t\t\t.attr(\"cy\", projection([0,0])[1]);","","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Country Labels ////////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Calculate the centers for each country","\t\t\tvar centers = getCenters(\"country\", [width, height/0.8]);","\t\t\tcenters.forEach(function(d) {","\t\t\t\t\td.y = d.y - 100;","\t\t\t\t\td.x = d.x + 0;","\t\t\t});//centers forEach","","\t\t\t//Wrapper for the country labels","\t\t\tvar labelWrapper = svg.append(\"g\")","\t\t\t\t.attr(\"class\", \"labelWrapper\");","\t\t\t\t","\t\t\t//Append the country labels","\t\t    labelWrapper.selectAll(\".label\")","\t\t      \t.data(centers)","\t\t      \t.enter().append(\"text\")","\t\t      \t.attr(\"class\", \"label\")","\t\t      \t.style(\"opacity\", 0)","\t\t      \t.attr(\"transform\", function (d) { return \"translate(\" + (d.x) + \", \" + (d.y - 60) + \")\"; })","\t\t      \t.text(function (d) { return d.name });","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Set-up the force //////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","","\t\t\tvar force = d3.layout.force()","\t\t\t\t.gravity(.02)","\t\t    \t.charge(0)","\t\t    \t.on(\"tick\", tick(centers, \"country\"));\t","\t\t","\t\t\tvar padding = 0;","\t\t\tvar maxRadius = d3.max(populations, function(d) { return d.radius; });\t","","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t///////////////////////////// Do the loop /////////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\tloop();\t","\t\t\tsetInterval(loop, 15000);","\t\t\t","\t\t\tfunction loop() {","\t\t\t\tplaceCities();","\t\t\t\tsetTimeout(clusterCountry, 7000);","\t\t\t\tsetTimeout(backToCenter, 12000);","\t\t\t}//loop","\t\t\t\t\t\t","\t\t\t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Animation steps ///////////////////////////////","\t\t\t///////////////////////////////////////////////////////////////////////////\t","\t\t\t\t\t","\t\t\t//Move the cities from the center to their actual locations","\t\t\tfunction placeCities () {","","\t\t\t\t//Stop the force layout (in case you move backward)","\t\t\t\tforce.stop();","","\t\t\t\t//Make the cover circle shrink","\t\t\t\td3.selectAll(\".cityCover\")","\t\t\t\t\t\t.transition().duration(5000)","\t\t\t\t\t\t.attr(\"r\", 0);","","\t\t\t\t//Put the cities in their geo location","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"move\").duration(2000)","\t\t\t\t\t.delay(function(d,i) { return i*20; })","\t\t\t\t\t.attr(\"r\", function(d) {","\t\t\t\t\t\treturn d.radius = rScale(d.population);","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cx\", function(d) {","\t\t\t\t\t\treturn d.x = projection([d.longitude, d.latitude])[0];","\t\t\t\t\t})","\t\t\t\t\t.attr(\"cy\", function(d) {","\t\t\t\t\t\treturn d.y = projection([d.longitude, d.latitude])[1];","\t\t\t\t\t});","\t\t\t\t\t\t","\t\t\t\t//Around the end of the transition above make the circles see-through a bit","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition(\"dim\").duration(2000).delay(4000)","\t\t\t\t\t.style(\"opacity\", 0.8);","","\t\t\t\t//\"Remove\" gooey filter from cities during the transition","\t\t\t\t//So at the end they do not appear to melt together anymore","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(4000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\"); ","\t\t\t\t\t});","","\t\t\t}//placeCities","","\t\t\t//Cluster all the cities based on the country","\t\t\tfunction clusterCountry() {","","\t\t\t\t///Start force again","\t\t\t\tforce.start();","","\t\t\t\t//Dim the map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0);","\t\t\t\t\t","\t\t\t\t//Show the labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"opacity\", 1);","","\t\t\t\t//Reset gooey filter values back to a visible \"gooey\" effect","\t\t\t   \td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(2000)","\t\t\t\t\t.attrTween(\"values\", function() { ","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -5\", ","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\"); ","\t\t\t\t\t});","","\t\t\t}//clusterCountry","","\t\t\t//Move the circles back to the center location again","\t\t\tfunction backToCenter () {","","\t\t\t\t//Stop the force layout","\t\t\t\tforce.stop();","","\t\t\t\t//Hide labels","\t\t\t\td3.selectAll(\".label\")","\t\t\t\t\t.transition().duration(500)","\t\t\t\t\t.style(\"opacity\", 0);","","\t\t\t\t//Show map","\t\t\t\td3.selectAll(\".geo-path\")","\t\t\t\t\t.transition().duration(1000)","\t\t\t\t\t.style(\"fill-opacity\", 0.5);","\t\t\t\t","\t\t\t   \t//Make the cover cirlce to its true size again","\t\t\t    d3.selectAll(\".cityCover\")","\t\t\t\t\t.transition().duration(3000).delay(500)","\t\t\t\t\t.attr(\"r\", coverCirleRadius);","","\t\t\t    //Move the cities to the 0,0 coordinate","\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t.transition()","\t\t\t\t\t.duration(2000).delay(function(d,i) { return i*10; })","\t\t\t\t\t.attr(\"cx\", projection([0, 0])[0])","\t\t\t\t\t.attr(\"cy\", projection([0, 0])[1])","\t\t\t\t\t.style(\"opacity\", 1);","\t\t\t\t\t","\t\t\t\td3.selectAll(\".blurValues\")","\t\t\t\t\t.transition().duration(1000).delay(1000)","\t\t\t\t\t.attrTween(\"values\", function() {","\t\t\t\t\t\treturn d3.interpolateString(\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -6\",","\t\t\t\t\t\t\t\t\t\t\t\t\t\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -5\");","\t\t\t\t\t});","","\t\t\t}//backToCenter","\t","\t\t \t///////////////////////////////////////////////////////////////////////////","\t\t\t/////////////////////////// Helper functions //////////////////////////////","\t\t\t/////////////////////////////////////////////////////////////////////////// ","","\t\t\t//Radial layout","\t\t\tfunction getCenters (vname, size) {","\t\t\t  \tvar centers = [], ","\t\t\t\t\tmapping,","\t\t\t\t\tflags = [];","\t\t\t\tfor( var i = 0; i < populations.length; i++) {","\t\t\t\t    if( flags[populations[i][vname]]) continue;","\t\t\t\t    flags[populations[i][vname]] = true;","\t\t\t\t    centers.push({name: populations[i][vname], value: 1});","\t\t\t\t}//for i","\t\t\t  \tcenters.sort(function(a, b){ return d3.ascending(a.name, b.name); });","","\t\t\t  \tmapping = d3.layout.pack()","\t\t\t  \t\t.sort(function(d) { return d[vname]; })","\t\t\t  \t\t.size(size);","\t\t\t  \tmapping.nodes({children: centers});","","\t\t\t  \treturn centers;","\t\t\t}//getCenters","\t","\t\t\t//Radial lay-out","\t\t\tfunction tick (centers, varname) {","\t\t\t\tvar foci = {};","\t\t\t\tfor (var i = 0; i < centers.length; i++) {","\t\t\t\t\tfoci[centers[i].name] = centers[i];","\t\t\t\t}","\t  ","\t\t\t\treturn function (e) {","\t\t\t\t\tfor (var i = 0; i < populations.length; i++) {","\t\t\t\t\t  var o = populations[i];","\t\t\t\t\t  var f = foci[o[varname]];","\t\t\t\t\t  o.y += (f.y - o.y) * e.alpha;","\t\t\t\t\t  o.x += (f.x - o.x) * e.alpha;","\t\t\t\t\t}//for","","\t\t\t\t\td3.selectAll(\".cities\")","\t\t\t\t\t\t.each(collide(.5))","\t\t\t\t\t\t.attr(\"cx\", function (d) { return d.x; })","\t\t\t\t\t\t.attr(\"cy\", function (d) { return d.y; });","","\t\t\t\t}//function","\t\t\t}//tick","","\t\t\tfunction collide(alpha) {","\t\t          var quadtree = d3.geom.quadtree(populations);","\t\t          return function (d) {","\t\t            var r = d.radius + maxRadius + padding,","\t\t                nx1 = d.x - r,","\t\t                nx2 = d.x + r,","\t\t                ny1 = d.y - r,","\t\t                ny2 = d.y + r;","\t\t            quadtree.visit(function(quad, x1, y1, x2, y2) {","\t\t              if (quad.point && (quad.point !== d)) {","\t\t                var x = d.x - quad.point.x,","\t\t                    y = d.y - quad.point.y,","\t\t                    l = Math.sqrt(x * x + y * y),","\t\t                    r = d.radius + quad.point.radius + padding;","\t\t                if (l < r) {","\t\t                  l = (l - r) / l * alpha;","\t\t                  d.x -= x *= l;","\t\t                  d.y -= y *= l;","\t\t                  quad.point.x += x;","\t\t                  quad.point.y += y;","\t\t                }","\t\t              }","\t\t              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;","\t\t            });","\t\t          };","\t\t    }//collide","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","\t\t</script>","","\t</body>","</html>"],"id":13},{"start":{"row":0,"column":0},"end":{"row":96,"column":7},"action":"insert","lines":["<!DOCTYPE html>","<html>","  <head>","    <meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>","\t<title>Scatterplot with Voronoi</title>","","\t<!-- D3.js -->\t","    <script src=\"https://d3js.org/d3.v3.js\"></script>","","\t<!-- Pym.js - iframe height handler for the Blog -->","\t<script src=\"pym.min.js\"></script>","\t","\t<!-- jQuery -->","\t<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js\"></script>","\t<!-- Latest compiled and minified CSS -->","\t<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css\">","\t<!-- Latest compiled and minified JavaScript -->","\t<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js\"></script>","\t","\t<!-- Open Sans & CSS -->","\t<link href=\"https://fonts.googleapis.com/css?family=Open+Sans:700,400,300\" rel='stylesheet' type='text/css'>","\t  <style>","\t\tbody {","\t\t  font-family: 'Open Sans', sans-serif;","\t\t  font-size: 12px;","\t\t  font-weight: 400;","\t\t  color: #525252;","\t\t  text-align: center;","\t\t}","\t\t","\t\thtml, body { ","\t\t\twidth:auto; ","\t\t\theight:auto; ","\t\t}","\t\t","\t\t.axis path,","\t\t.axis line {","\t\t\tfill: none;","\t\t\tstroke: #B3B3B3;","\t\t\tshape-rendering: crispEdges;","\t\t}","\t\t.axis text {","\t\t\tfont-size: 10px;","\t\t\tfill: #6B6B6B;","\t\t}","\t\t","\t\t.popover {","\t\t\tpointer-events: none;","\t\t}","","\t\t.legendTitle {","\t\t\tfill: #1A1A1A;","\t\t\tcolor: #1A1A1A;","\t\t\ttext-anchor: middle;","\t\t\tfont-size: 10px;","\t\t}","","\t\t.legendText {","\t\t\tfill: #949494;","\t\t\ttext-anchor: start;","\t\t\tfont-size: 9px;","\t\t}","\t\t","\t\t@media (min-width: 500px) {","\t\t  .col-sm-3, .col-sm-9 {","\t\t\tfloat: left;","\t\t  }","\t\t  .col-sm-9 {","\t\t\twidth: 75%;","\t\t  }","\t\t  .col-sm-3 {","\t\t\twidth: 25%;","\t\t  }","\t\t}","\t  </style>","  </head>","  <body>","","\t<div id=\"cont\" class=\"container-fluid text-center\">","\t\t<div class=\"row scatter\">","\t\t\t<h5 style=\"color: #3B3B3B;\">Life expectancy versus GDP per Capita</h5>","\t\t\t<h6 style=\"color: #A6A6A6;\">Voronoi - Tooltip attached to circles</h6>","\t\t\t<div class=\"col-sm-9\">","\t\t\t\t<div id=\"chart\"></div>","\t\t\t</div>","\t\t\t<div id = \"legend\" class=\"col-sm-3\">","\t\t\t\t<div class=\"legendTitle\" style=\"font-size: 12px;\">REGION</div>","\t\t\t\t<div id=\"legend\"></div>","\t\t\t</div>","\t\t</div>","\t</div>","","\t<script src=\"worldbank.js\"></script>","    <script src=\"script.js\"></script>","\t","  </body>","</html>"]}],[{"start":{"row":96,"column":7},"end":{"row":97,"column":0},"action":"insert","lines":["",""],"id":14}],[{"start":{"row":96,"column":7},"end":{"row":97,"column":0},"action":"remove","lines":["",""],"id":15}]]},"ace":{"folds":[],"scrolltop":1017,"scrollleft":0,"selection":{"start":{"row":96,"column":7},"end":{"row":96,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":71,"state":"css-ruleset","mode":"ace/mode/html"}},"timestamp":1587341103028,"hash":"b8a32eb2e1176a9f5b9f941d3020aa69b62f2082"}